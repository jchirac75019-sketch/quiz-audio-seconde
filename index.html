<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- ========== ENCODAGE - CHARACTER ENCODING ========== -->
    <meta charset="UTF-8">
    
    <!-- ========== VIEWPORT - MOBILE CONFIGURATION ========== -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ========== SERVICE WORKER REGISTRATION - PWA OFFLINE ==========
         Enregistre le Service Worker pour fonctionnement hors ligne
    ========== -->
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(() => {
          console.log('âœ… Service Worker enregistrÃ© avec succÃ¨s');
        }).catch(err => {
          console.error('âš ï¸ Erreur enregistrement Service Worker:', err);
        });
      }
    </script>
    
    <!-- ========== MANIFEST POUR PWA - APP INSTALLATION ==========
         Permet installation comme app native sur tÃ©lÃ©phone + ordinateur
    ========== -->
    <link rel="manifest" href="/quiz-audio-seconde/manifest.json">
    
    <!-- ========== CONFIGURATION WINDOWS - WINDOWS TILE ==========
         Pour l'Ã©pingle au menu DÃ©marrer sur Windows
    ========== -->
    <meta name="msapplication-config" content="/quiz-audio-seconde/browserconfig.xml">
    <meta name="msapplication-TileColor" content="#1976d2">
    <meta name="msapplication-TileImage" content="/quiz-audio-seconde/images/icon-192.png">
    
    <!-- ========== CONFIGURATION ANDROID - ANDROID APP ==========
         Couleur thÃ¨me pour Android + capacitÃ©s web app
    ========== -->
    <meta name="theme-color" content="#1976d2">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- ========== CONFIGURATION iOS/APPLE - iOS APP ==========
         Support pour iOS et macOS
    ========== -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø§Ø®ØªØ¨Ø§Ø± Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†">
    <link rel="apple-touch-icon" href="/quiz-audio-seconde/images/icon-192.png">
    
    <!-- ========== FAVICON & ICÃ”NES - ICONS & FAVICON ==========
         RÃ©fÃ©rences aux icÃ´nes pour diffÃ©rents appareils
    ========== -->
    <link rel="icon" href="/quiz-audio-seconde/images/icon-192.png" sizes="192x192" type="image/png">
    <link rel="icon" href="/quiz-audio-seconde/images/icon-512.png" sizes="512x512" type="image/png">
    
    <!-- Favicon SVG inline (secours) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“–</text></svg>">
    
    <!-- ========== TITRE DE PAGE - PAGE TITLE ========== -->
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
    
    <!-- ========== STYLES INLINE - INLINE STYLES (ORIGINAL PRESERVED) ==========
         Tous les styles CSS originaux conservÃ©s intÃ©gralement
    ========== -->
    <style>

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', 'Tahoma', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            line-height: 1.6;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        .header {
             text-align: center;
             margin-bottom: 10px;      /* rÃ©duire l'espacement sous le header */
             padding: 5px 0;          /* diminuer la hauteur interne (au lieu de 40px prÃ©cÃ©demment) */
             color: white;
        }

        .header h1 {
            font-size: 2em;           /* optionnel : rÃ©duire un peu la taille de police */
            margin-bottom: 10px;
            //text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 1px;       /* espacement rÃ©duit sous le titre */
        }

        .header p {
            font-size: 1em;         /* diminuer la taille du sous-titre */
            opacity: 0.9;
        }

        .filters-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .filter-group {
            margin-bottom: 30px;
        }

        .filter-group h2 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 10px;
        }

        .filter-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-item {
            flex: 1;
            min-width: 250px;
        }

        .filter-item.full-width {
            flex: 100%;
        }

        .filter-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .filter-item select,
        .filter-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .filter-item select:focus,
        .filter-item input:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 5px rgba(25,118,210,0.3);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #1976d2;
            background-color: #f5f5f5;
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .radio-option input[type="radio"]:checked + span {
            color: #1976d2;
            font-weight: bold;
        }

        .error-msg {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            padding: 8px;
            border-radius: 4px;
            background-color: #ffebee;
            border: 1px solid #f44336;
            display: none;
        }

        .error-msg.show {
            display: block;
        }

        .verses-counter {
            text-align: center;
            margin: 30px 0;
        }

        .counter-box {
            display: inline-block;
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            color: white;
            padding: 20px 30px;
            border-radius: 50px;
            font-size: 1.2em;
            box-shadow: 0 5px 15px rgba(33,150,243,0.4);
        }

        .count-number {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .start-btn {
            width: 100%;
            padding: 20px;
            font-size: 1.3em;
            color: white;
            background: linear-gradient(45deg, #4caf50, #45a049);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(76,175,80,0.4);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(76,175,80,0.6);
        }

        .start-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 10px; /* au lieu de 30px, rÃ©duit l'espace */
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 20px;
        }

        .home-btn {
            padding: 12px 20px;
            background: #ff9800;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .home-btn:hover {
            background: #f57c00;
        }

        .quiz-info {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .quiz-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
        }

        .stat.correct {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .stat.incorrect {
            background: #ffebee;
            color: #c62828;
        }

        .stat.remaining {
            background: #e3f2fd;
            color: #1565c0;
        }

        .timer {
            font-size: 18px;
            font-weight: bold;
            color: #1976d2;
        }

        .quiz-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px;           /* RÃ©duit de 30px Ã  15px */
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 10px; /* Ã©limine l'espace par dÃ©faut, ajustez si nÃ©cessaire */
        }

        .quiz-mode {
            display: none;
        }

        .quiz-mode.active {
            display: block;
        }

        .question-card {
            text-align: center;
        }

        .question-card h2 {
            color: #1976d2;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        /* RÃ©duit l'espace au-dessus du titre en mode audio */
           #mode-2 .question-card h2 {
           margin-top: 10px;        /* RÃ©duit l'espace au-dessus */
           margin-bottom: 15px;     /* RÃ©duit l'espace en-dessous */
        }

        .verse-info {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 5px solid #1976d2;
        }

        .verse-info div {
            margin: 10px 0;
            font-size: 1.1em;
        }

        .surah-name,
        .verse-number,
        .page-number,
        .chapter-number {
            color: #1976d2;
            font-weight: bold;
        }

        .verse-number.highlight {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #ffc107;
            font-size: 1.2em;
        }

        .verse-text-container {
            margin: 30px 0;
        }

        .verse-text {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            font-size: 1.4em;
            line-height: 1.8;
            color: #2c3e50;
            border: 2px solid #e9ecef;
            margin: 20px 0;
            text-align: center;
        }

        .verse-text.hidden {
            display: none;
        }

        .audio-container {
            margin: 5px 0;          /* RÃ©duit de 30px Ã  5px */
            text-align: center;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 8px;               /* RÃ©duit de 15px Ã  8px */
            margin-top: 2px;        /* RÃ©duit de 20px Ã  2px */
            margin-bottom: -10px; /* remonte les boutons par rapport Ã  l'Ã©lÃ©ment suivant */
        }

        .verse-info-container.hidden {
            display: none;
        }

        /* RÃ©duit l'espace du lecteur audio */
           #verse-audio {
           margin: 10px 0;          /* RÃ©duit l'espace autour */
           max-width: 100%;
        }

        .verse-details {
            background: #f5f5f5;
            padding: 12px;           /* RÃ©duit de 20px Ã  12px */
            border-radius: 10px;
            margin: 10px 0;          /* RÃ©duit de 20px Ã  10px */
            border-right: 5px solid #1976d2;
        }

        .verse-details div {
            margin: 5px 0;           /* RÃ©duit de 10px Ã  5px */
            font-size: 1.1em;
        }

        .action-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .show-btn {
            background: #2196f3;
            color: white;
        }

        .show-btn:hover {
            background: #1976d2;
        }

        .answer-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;               /* RÃ©duit de 20px Ã  15px */
            margin-top: 15px;        /* RÃ©duit de 30px Ã  15px */
            flex-wrap: wrap;
        }

        .answer-buttons.hidden {
            display: none;
        }

        .answer-btn {
            padding: 15px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .correct-btn {
            background: #4caf50;
            color: white;
        }

        .correct-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76,175,80,0.4);
        }

        .incorrect-btn {
            background: #f44336;
            color: white;
        }

        .incorrect-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244,67,54,0.4);
        }

        .next-btn {
            background: #ff9800;
            color: white;
            width: 100%;
            padding: 15px;           /* RÃ©duit de 20px Ã  15px */
            font-size: 1.2em;
            margin-top: 15px;        /* RÃ©duit de 30px Ã  15px */
        }

        .next-btn:hover {
            background: #f57c00;
        }

        .next-btn.hidden {
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            color: white;
            flex-wrap: wrap;
            gap: 20px;
        }

        .results-header h1 {
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .results-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .results-summary {
            margin-bottom: 40px;
        }

        .summary-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .summary-card h2 {
            color: #1976d2;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .stat-item.correct {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .stat-item.incorrect {
            background: #ffebee;
            color: #c62828;
        }

        .stat-item.total {
            background: #e3f2fd;
            color: #1565c0;
        }

        .stat-item.percentage {
            background: #fff3e0;
            color: #ef6c00;
        }

        .time-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .time-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            border-right: 4px solid #1976d2;
        }

        .results-history h2 {
            color: #1976d2;
            margin-bottom: 20px;
            text-align: center;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s ease;
        }

        .history-item:hover {
            background: #f8f9fa;
        }

        .history-item.correct {
            border-right: 4px solid #4caf50;
        }

        .history-item.incorrect {
            border-right: 4px solid #f44336;
        }

        .history-question {
            flex: 1;
            color: #1976d2;
            font-weight: bold;
        }

        .history-result {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .history-result.correct {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .history-result.incorrect {
            background: #ffebee;
            color: #c62828;
        }

        .results-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .loading.hidden {
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #1976d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            font-size: 1.2em;
            margin-top: 20px;
        }

        .next-question {
        display: flex;
        justify-content: center;
        }

        .next-question button {
        margin: 0;
       }

       @media (max-width: 768px) {
           .container { padding: 10px; }
           .header h1 { font-size: 2em; }
           .filters-section { padding: 20px; }
           .filter-row { flex-direction: column; }
           .quiz-header { flex-direction: column; text-align: center; }
           .quiz-info { justify-content: center; }
           .quiz-stats { justify-content: center; }
           .answer-buttons {
               display: flex;
               flex-direction: row;          /* ligne unique */
               justify-content: space-between; /* espace entre boutons */
               flex-wrap: nowrap;            /* interdit le retour Ã  la ligne */
               gap: 8px;                     /* petit Ã©cart horizontal */
               margin-top: 10px;
       }
          .answer-buttons .answer-btn {
              flex: 1;                      /* largeur Ã©gale */
              min-width: 0;                 /* autorise la rÃ©duction */
              max-width: calc(50% - 4px);   /* deux fois 50% moins la moitiÃ© du gap */
       }

           .answer-btn { width: 100%; max-width: 300px; }
           .results-header { flex-direction: column; text-align: center; }
           .results-actions { flex-direction: column; align-items: center; }
           .results-actions .action-btn { width: 100%; max-width: 300px; }
           .summary-stats { grid-template-columns: 1fr; }
           .time-info { grid-template-columns: 1fr; }
           .history-item { flex-direction: column; align-items: flex-start; gap: 10px; }

       /* Compactage spÃ©cifique au quiz-mode audio */
           .quiz-content { padding: 10px; }
          #mode-2 .question-card h2 {
           margin-top: 5px;
           margin-bottom: 10px;
           font-size: 1.4em;
       }
           .audio-container { margin: 5px 0; }
           .audio-controls { 
           margin-top: 5px; 
           gap: 8px; 
       }
           .verse-details { 
           padding: 10px; 
           margin: 8px 0; 
       }
           .next-btn { 
           padding: 12px; 
           margin-top: 10px; 
       }
          #verse-audio {
           margin-bottom: 0;    /* Annule l'espace sous le lecteur audio */
           padding: 0;
       }
          .audio-controls {
           margin-top: 2px;
           gap: 6px;          /* Vous pouvez rÃ©duire aussi le gap */
       }
          .quiz-header {
           margin-bottom: 8px;  /* encore plus compact sur mobile */
       }
          .quiz-content {
           margin-top: 8px;
       }
      /* RÃ©duit la hauteur des boutons uniquement sur mobile */
          .answer-btn,
          .action-btn,
          .next-btn {
          padding: 6px 12px;    /* 6px vertical, 12px horizontal */
          font-size: 0.9em;     /* ajuste la taille du texte */
      }
          .verse-text-container { margin-bottom: 4px; }
          .verse-text           { margin-bottom: 4px; }
          .answer-buttons       { margin-top: 4px; }
      }
   }

        @media (max-width: 480px) {
            .header h1 { font-size: 1.6em; }
            .filter-item { min-width: 100%; }
            .radio-group { gap: 10px; }
            .radio-option { padding: 12px; font-size: 14px; }
            .verse-text { font-size: 1.2em; padding: 20px; }
            .quiz-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="home-page" class="page active">
        <div class="container">
            <header class="header">
                <h1>ğŸ•Œ Ø§Ø®ØªØ¨Ø§Ø± Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
                <p>ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ ØªÙ‚Ø¯Ù…ÙŠ (PWA) Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©</p>
            </header>

            <div class="filters-section">
                <div class="filter-group">
                    <h2>ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                    
                    <div class="filter-row">
                        <div class="filter-item">
                            <label>Ù…Ù† Ø§Ù„Ø³ÙˆØ±Ø©:</label>
                            <select id="start-surah"></select>
                        </div>
                        <div class="filter-item">
                            <label>Ù…Ù† Ø§Ù„Ø¢ÙŠØ© Ø±Ù‚Ù…:</label>
                            <input type="number" id="start-verse" min="1" value="1">
                            <div class="error-msg" id="start-verse-error"></div>
                        </div>
                    </div>

                    <div class="filter-row">
                        <div class="filter-item">
                            <label>Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø©:</label>
                            <select id="end-surah"></select>
                        </div>
                        <div class="filter-item">
                            <label>Ø¥Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ© Ø±Ù‚Ù…:</label>
                            <input type="number" id="end-verse" min="1">
                            <div class="error-msg" id="end-verse-error"></div>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                    
                    <div class="filter-row">
                        <div class="filter-item">
                            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª:</label>
                            <select id="attempts-count">
                                <option value="5">5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª</option>
                                <option value="10">10 Ù…Ø­Ø§ÙˆÙ„Ø§Øª</option>
                                <option value="15">15 Ù…Ø­Ø§ÙˆÙ„Ø©</option>
                                <option value="20">20 Ù…Ø­Ø§ÙˆÙ„Ø©</option>
                                <option value="infinite">âˆ Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>Ø§Ù„Ù‚Ø§Ø±Ø¦:</label>
                            <select id="reciter-select"></select>
                        </div>
                    </div>

                    <div class="filter-row">
                        <div class="filter-item full-width">
                            <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="quiz-mode" value="verse-number" checked>
                                    <span>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„: ØªØ®Ù…ÙŠÙ† Ù†Øµ Ø§Ù„Ø¢ÙŠØ© Ù…Ù† Ø±Ù‚Ù…Ù‡Ø§</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="quiz-mode" value="audio-recitation">
                                    <span>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¢ÙŠØ© Ù…Ù† Ø§Ù„ØªÙ„Ø§ÙˆØ© (Ø§Ù„Ø£Ù‡Ù…)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="verses-counter">
                    <div class="counter-box">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯:</span>
                        <span id="verses-count" class="count-number">0</span>
                        <span>Ø¢ÙŠØ©</span>
                    </div>
                </div>

                <button id="start-quiz" class="start-btn">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
    <div id="quiz-page" class="page">
        <div class="container">
            <header class="quiz-header">
                <button id="home-btn" class="home-btn">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <div class="quiz-info">
                    <div class="quiz-stats">
                        <span class="stat correct">âœ… <span id="correct-count">0</span></span>
                        <span class="stat incorrect">âŒ <span id="incorrect-count">0</span></span>
                        <span class="stat remaining">ğŸ“Š <span id="remaining-count">0</span></span>
                    </div>
                    <div class="timer">â±ï¸ <span id="timer-display">00:00:00</span></div>
                </div>
            </header>

            <div class="quiz-content">
                <!-- Ø§Ù„ÙˆØ¶Ø¹ 1: Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© -->
                <div id="mode-1" class="quiz-mode">
                    <div class="question-card">
                        <h2>â“ Ù…Ø§ Ù†Øµ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ</h2>
                        <div class="verse-info">
                            <div class="surah-name">Ø³ÙˆØ±Ø©: <span id="current-surah-name"></span></div>
                            <div class="verse-number">Ø§Ù„Ø¢ÙŠØ© Ø±Ù‚Ù…: <span id="current-verse-number"></span></div>
                            <div class="page-number">Ø§Ù„ØµÙØ­Ø©: <span id="current-page-number"></span></div>
                        </div>
                        
                        <div class="verse-text-container">
                            <div id="verse-text" class="verse-text hidden"></div>
                            <button id="show-verse" class="action-btn show-btn">ğŸ“– Ø¥Ø¸Ù‡Ø§Ø± Ù†Øµ Ø§Ù„Ø¢ÙŠØ©</button>
                        </div>

                        <div class="answer-buttons hidden" id="answer-buttons">
                            <button class="answer-btn correct-btn" data-answer="correct">âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©</button>
                            <button class="answer-btn incorrect-btn" data-answer="incorrect">âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©</button>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„ÙˆØ¶Ø¹ 2: Ø§Ù„ØªÙ„Ø§ÙˆØ© Ø§Ù„ØµÙˆØªÙŠØ© -->
                <div id="mode-2" class="quiz-mode">
                    <div class="question-card">
                        <h2>ğŸ§ Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ØªÙ„Ø§ÙˆØ© ÙˆØ­Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ©</h2>
                        
                        <div class="audio-container">
                            <audio id="verse-audio" controls style="width: 100%; margin: 1px 0;"></audio>
                            <div class="audio-controls">
                                <button id="play-audio" class="action-btn">â–¶ï¸ ØªØ´ØºÙŠÙ„</button>
                                <button id="repeat-audio" class="action-btn">ğŸ” Ø¥Ø¹Ø§Ø¯Ø©</button>
                            </div>
                        </div>

                        <div class="verse-info-container hidden" id="verse-info-container">
                            <div class="verse-details">
                                <div class="surah-name">Ø³ÙˆØ±Ø©: <span id="audio-surah-name"></span></div>
                                <div class="verse-number highlight">Ø§Ù„Ø¢ÙŠØ© Ø±Ù‚Ù…: <span id="audio-verse-number"></span></div>
                                <div class="page-number">Ø§Ù„ØµÙØ­Ø©: <span id="audio-page-number"></span></div>
                                <div class="chapter-number">Ø§Ù„Ø¬Ø²Ø¡: <span id="audio-chapter-number"></span></div>
                            </div>
                            <div id="audio-verse-text" class="verse-text"></div>
                        </div>

                        <div class="quiz-actions">
                            <button id="show-verse-info" class="action-btn show-btn">ğŸ“‹ Ø¥Ø¸Ù‡Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¢ÙŠØ©</button>
                            
                            <div class="answer-buttons hidden" id="audio-answer-buttons">
                                <button class="answer-btn correct-btn" data-answer="correct">âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©</button>
                                <button class="answer-btn incorrect-btn" data-answer="incorrect">âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="next-question">
                    <button id="next-question" class="action-btn next-btn hidden">â­ï¸ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div id="results-page" class="page">
        <div class="container">
            <header class="results-header">
                <h1>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
                <button id="home-btn-results" class="home-btn">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            </header>

            <div class="results-content">
                <div class="results-summary">
                    <div class="summary-card">
                        <h2>ğŸ“ˆ Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
                        <div class="summary-stats">
                            <div class="stat-item correct">
                                <span class="stat-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©:</span>
                                <span class="stat-value" id="final-correct">0</span>
                            </div>
                            <div class="stat-item incorrect">
                                <span class="stat-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©:</span>
                                <span class="stat-value" id="final-incorrect">0</span>
                            </div>
                            <div class="stat-item total">
                                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</span>
                                <span class="stat-value" id="final-total">0</span>
                            </div>
                            <div class="stat-item percentage">
                                <span class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:</span>
                                <span class="stat-value" id="final-percentage">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="time-info">
                        <div class="time-item">
                            <span>â° ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</span>
                            <span id="start-time">--</span>
                        </div>
                        <div class="time-item">
                            <span>ğŸ ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</span>
                            <span id="end-time">--</span>
                        </div>
                        <div class="time-item">
                            <span>â±ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª:</span>
                            <span id="total-time">00:00:00</span>
                        </div>
                    </div>
                </div>

                <div class="results-history">
                    <h2>ğŸ“ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</h2>
                    <div id="history-list" class="history-list"></div>
                </div>

                <div class="results-actions">
                    <button id="new-quiz" class="action-btn">ğŸ†• Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</button>
                    <button id="download-results" class="action-btn">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <p>Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø§Ù„Ø³ÙˆØ± (Ø­ÙØµ 604 ØµÙØ­Ø§Øª) - ÙÙ‡Ø±Ø³ Ù…Ø­Ù„ÙŠ Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø©
        const SURAHS = [
            { n: 1, name: 'Ø§Ù„ÙØ§ØªØ­Ø©', v: 7, p: { s: 1, e: 1 } },
            { n: 2, name: 'Ø§Ù„Ø¨Ù‚Ø±Ø©', v: 286, p: { s: 2, e: 49 } },
            { n: 3, name: 'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†', v: 200, p: { s: 50, e: 76 } },
            { n: 4, name: 'Ø§Ù„Ù†Ø³Ø§Ø¡', v: 176, p: { s: 77, e: 106 } },
            { n: 5, name: 'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©', v: 120, p: { s: 106, e: 127 } },
            { n: 6, name: 'Ø§Ù„Ø£Ù†Ø¹Ø§Ù…', v: 165, p: { s: 128, e: 150 } },
            { n: 7, name: 'Ø§Ù„Ø£Ø¹Ø±Ø§Ù', v: 206, p: { s: 151, e: 176 } },
            { n: 8, name: 'Ø§Ù„Ø£Ù†ÙØ§Ù„', v: 75, p: { s: 177, e: 187 } },
            { n: 9, name: 'Ø§Ù„ØªÙˆØ¨Ø©', v: 129, p: { s: 187, e: 207 } },
            { n: 10, name: 'ÙŠÙˆÙ†Ø³', v: 109, p: { s: 208, e: 221 } },
            { n: 11, name: 'Ù‡ÙˆØ¯', v: 123, p: { s: 221, e: 235 } },
            { n: 12, name: 'ÙŠÙˆØ³Ù', v: 111, p: { s: 235, e: 248 } },
            { n: 13, name: 'Ø§Ù„Ø±Ø¹Ø¯', v: 43, p: { s: 249, e: 255 } },
            { n: 14, name: 'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', v: 52, p: { s: 255, e: 261 } },
            { n: 15, name: 'Ø§Ù„Ø­Ø¬Ø±', v: 99, p: { s: 262, e: 267 } },
            { n: 16, name: 'Ø§Ù„Ù†Ø­Ù„', v: 128, p: { s: 267, e: 281 } },
            { n: 17, name: 'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡', v: 111, p: { s: 282, e: 293 } },
            { n: 18, name: 'Ø§Ù„ÙƒÙ‡Ù', v: 110, p: { s: 293, e: 304 } },
            { n: 19, name: 'Ù…Ø±ÙŠÙ…', v: 98, p: { s: 305, e: 312 } },
            { n: 20, name: 'Ø·Ù‡', v: 135, p: { s: 312, e: 322 } },
            { n: 21, name: 'Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡', v: 112, p: { s: 322, e: 331 } },
            { n: 22, name: 'Ø§Ù„Ø­Ø¬', v: 78, p: { s: 332, e: 341 } },
            { n: 23, name: 'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†', v: 118, p: { s: 342, e: 349 } },
            { n: 24, name: 'Ø§Ù„Ù†ÙˆØ±', v: 64, p: { s: 350, e: 359 } },
            { n: 25, name: 'Ø§Ù„ÙØ±Ù‚Ø§Ù†', v: 77, p: { s: 359, e: 366 } },
            { n: 26, name: 'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡', v: 227, p: { s: 367, e: 377 } },
            { n: 27, name: 'Ø§Ù„Ù†Ù…Ù„', v: 93, p: { s: 377, e: 385 } },
            { n: 28, name: 'Ø§Ù„Ù‚ØµØµ', v: 88, p: { s: 385, e: 396 } },
            { n: 29, name: 'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª', v: 69, p: { s: 396, e: 404 } },
            { n: 30, name: 'Ø§Ù„Ø±ÙˆÙ…', v: 60, p: { s: 404, e: 411 } },
            { n: 31, name: 'Ù„Ù‚Ù…Ø§Ù†', v: 34, p: { s: 411, e: 414 } },
            { n: 32, name: 'Ø§Ù„Ø³Ø¬Ø¯Ø©', v: 30, p: { s: 415, e: 417 } },
            { n: 33, name: 'Ø§Ù„Ø£Ø­Ø²Ø§Ø¨', v: 73, p: { s: 418, e: 427 } },
            { n: 34, name: 'Ø³Ø¨Ø£', v: 54, p: { s: 428, e: 434 } },
            { n: 35, name: 'ÙØ§Ø·Ø±', v: 45, p: { s: 434, e: 440 } },
            { n: 36, name: 'ÙŠØ³', v: 83, p: { s: 440, e: 446 } },
            { n: 37, name: 'Ø§Ù„ØµØ§ÙØ§Øª', v: 182, p: { s: 446, e: 453 } },
            { n: 38, name: 'Øµ', v: 88, p: { s: 453, e: 458 } },
            { n: 39, name: 'Ø§Ù„Ø²Ù…Ø±', v: 75, p: { s: 458, e: 467 } },
            { n: 40, name: 'ØºØ§ÙØ±', v: 85, p: { s: 467, e: 477 } },
            { n: 41, name: 'ÙØµÙ„Øª', v: 54, p: { s: 477, e: 482 } },
            { n: 42, name: 'Ø§Ù„Ø´ÙˆØ±Ù‰', v: 53, p: { s: 483, e: 489 } },
            { n: 43, name: 'Ø§Ù„Ø²Ø®Ø±Ù', v: 89, p: { s: 489, e: 496 } },
            { n: 44, name: 'Ø§Ù„Ø¯Ø®Ø§Ù†', v: 59, p: { s: 496, e: 499 } },
            { n: 45, name: 'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©', v: 37, p: { s: 499, e: 502 } },
            { n: 46, name: 'Ø§Ù„Ø£Ø­Ù‚Ø§Ù', v: 35, p: { s: 502, e: 505 } },
            { n: 47, name: 'Ù…Ø­Ù…Ø¯', v: 38, p: { s: 507, e: 510 } },
            { n: 48, name: 'Ø§Ù„ÙØªØ­', v: 29, p: { s: 511, e: 515 } },
            { n: 49, name: 'Ø§Ù„Ø­Ø¬Ø±Ø§Øª', v: 18, p: { s: 515, e: 517 } },
            { n: 50, name: 'Ù‚', v: 45, p: { s: 518, e: 520 } },
            { n: 51, name: 'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª', v: 60, p: { s: 520, e: 523 } },
            { n: 52, name: 'Ø§Ù„Ø·ÙˆØ±', v: 49, p: { s: 523, e: 526 } },
            { n: 53, name: 'Ø§Ù„Ù†Ø¬Ù…', v: 62, p: { s: 526, e: 528 } },
            { n: 54, name: 'Ø§Ù„Ù‚Ù…Ø±', v: 55, p: { s: 528, e: 531 } },
            { n: 55, name: 'Ø§Ù„Ø±Ø­Ù…Ù†', v: 78, p: { s: 531, e: 534 } },
            { n: 56, name: 'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©', v: 96, p: { s: 534, e: 537 } },
            { n: 57, name: 'Ø§Ù„Ø­Ø¯ÙŠØ¯', v: 29, p: { s: 537, e: 541 } },
            { n: 58, name: 'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©', v: 22, p: { s: 542, e: 545 } },
            { n: 59, name: 'Ø§Ù„Ø­Ø´Ø±', v: 24, p: { s: 545, e: 548 } },
            { n: 60, name: 'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©', v: 13, p: { s: 549, e: 551 } },
            { n: 61, name: 'Ø§Ù„ØµÙ', v: 14, p: { s: 551, e: 552 } },
            { n: 62, name: 'Ø§Ù„Ø¬Ù…Ø¹Ø©', v: 11, p: { s: 553, e: 554 } },
            { n: 63, name: 'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†', v: 11, p: { s: 554, e: 555 } },
            { n: 64, name: 'Ø§Ù„ØªØºØ§Ø¨Ù†', v: 18, p: { s: 556, e: 557 } },
            { n: 65, name: 'Ø§Ù„Ø·Ù„Ø§Ù‚', v: 12, p: { s: 558, e: 559 } },
            { n: 66, name: 'Ø§Ù„ØªØ­Ø±ÙŠÙ…', v: 12, p: { s: 560, e: 561 } },
            { n: 67, name: 'Ø§Ù„Ù…Ù„Ùƒ', v: 30, p: { s: 562, e: 564 } },
            { n: 68, name: 'Ø§Ù„Ù‚Ù„Ù…', v: 52, p: { s: 564, e: 566 } },
            { n: 69, name: 'Ø§Ù„Ø­Ø§Ù‚Ø©', v: 52, p: { s: 566, e: 569 } },
            { n: 70, name: 'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬', v: 44, p: { s: 569, e: 570 } },
            { n: 71, name: 'Ù†ÙˆØ­', v: 28, p: { s: 570, e: 572 } },
            { n: 72, name: 'Ø§Ù„Ø¬Ù†', v: 28, p: { s: 572, e: 574 } },
            { n: 73, name: 'Ø§Ù„Ù…Ø²Ù…Ù„', v: 20, p: { s: 574, e: 575 } },
            { n: 74, name: 'Ø§Ù„Ù…Ø¯Ø«Ø±', v: 56, p: { s: 575, e: 577 } },
            { n: 75, name: 'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©', v: 40, p: { s: 577, e: 578 } },
            { n: 76, name: 'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†', v: 31, p: { s: 578, e: 580 } },
            { n: 77, name: 'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª', v: 50, p: { s: 580, e: 582 } },
            { n: 78, name: 'Ø§Ù„Ù†Ø¨Ø£', v: 40, p: { s: 582, e: 583 } },
            { n: 79, name: 'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª', v: 46, p: { s: 583, e: 585 } },
            { n: 80, name: 'Ø¹Ø¨Ø³', v: 42, p: { s: 585, e: 586 } },
            { n: 81, name: 'Ø§Ù„ØªÙƒÙˆÙŠØ±', v: 29, p: { s: 586, e: 587 } },
            { n: 82, name: 'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±', v: 19, p: { s: 587, e: 587 } },
            { n: 83, name: 'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†', v: 36, p: { s: 587, e: 589 } },
            { n: 84, name: 'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚', v: 25, p: { s: 589, e: 590 } },
            { n: 85, name: 'Ø§Ù„Ø¨Ø±ÙˆØ¬', v: 22, p: { s: 590, e: 590 } },
            { n: 86, name: 'Ø§Ù„Ø·Ø§Ø±Ù‚', v: 17, p: { s: 591, e: 591 } },
            { n: 87, name: 'Ø§Ù„Ø£Ø¹Ù„Ù‰', v: 19, p: { s: 591, e: 592 } },
            { n: 88, name: 'Ø§Ù„ØºØ§Ø´ÙŠØ©', v: 26, p: { s: 592, e: 592 } },
            { n: 89, name: 'Ø§Ù„ÙØ¬Ø±', v: 30, p: { s: 593, e: 594 } },
            { n: 90, name: 'Ø§Ù„Ø¨Ù„Ø¯', v: 20, p: { s: 594, e: 594 } },
            { n: 91, name: 'Ø§Ù„Ø´Ù…Ø³', v: 15, p: { s: 595, e: 595 } },
            { n: 92, name: 'Ø§Ù„Ù„ÙŠÙ„', v: 21, p: { s: 595, e: 595 } },
            { n: 93, name: 'Ø§Ù„Ø¶Ø­Ù‰', v: 11, p: { s: 596, e: 596 } },
            { n: 94, name: 'Ø§Ù„Ø´Ø±Ø­', v: 8, p: { s: 596, e: 596 } },
            { n: 95, name: 'Ø§Ù„ØªÙŠÙ†', v: 8, p: { s: 597, e: 597 } },
            { n: 96, name: 'Ø§Ù„Ø¹Ù„Ù‚', v: 19, p: { s: 597, e: 597 } },
            { n: 97, name: 'Ø§Ù„Ù‚Ø¯Ø±', v: 5, p: { s: 598, e: 598 } },
            { n: 98, name: 'Ø§Ù„Ø¨ÙŠÙ†Ø©', v: 8, p: { s: 598, e: 599 } },
            { n: 99, name: 'Ø§Ù„Ø²Ù„Ø²Ù„Ø©', v: 8, p: { s: 599, e: 599 } },
            { n: 100, name: 'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª', v: 11, p: { s: 599, e: 600 } },
            { n: 101, name: 'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©', v: 11, p: { s: 600, e: 600 } },
            { n: 102, name: 'Ø§Ù„ØªÙƒØ§Ø«Ø±', v: 8, p: { s: 600, e: 600 } },
            { n: 103, name: 'Ø§Ù„Ø¹ØµØ±', v: 3, p: { s: 601, e: 601 } },
            { n: 104, name: 'Ø§Ù„Ù‡Ù…Ø²Ø©', v: 9, p: { s: 601, e: 601 } },
            { n: 105, name: 'Ø§Ù„ÙÙŠÙ„', v: 5, p: { s: 601, e: 601 } },
            { n: 106, name: 'Ù‚Ø±ÙŠØ´', v: 4, p: { s: 602, e: 602 } },
            { n: 107, name: 'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†', v: 7, p: { s: 602, e: 602 } },
            { n: 108, name: 'Ø§Ù„ÙƒÙˆØ«Ø±', v: 3, p: { s: 602, e: 602 } },
            { n: 109, name: 'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†', v: 6, p: { s: 603, e: 603 } },
            { n: 110, name: 'Ø§Ù„Ù†ØµØ±', v: 3, p: { s: 603, e: 603 } },
            { n: 111, name: 'Ø§Ù„Ù…Ø³Ø¯', v: 5, p: { s: 603, e: 603 } },
            { n: 112, name: 'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ', v: 4, p: { s: 604, e: 604 } },
            { n: 113, name: 'Ø§Ù„ÙÙ„Ù‚', v: 5, p: { s: 604, e: 604 } },
            { n: 114, name: 'Ø§Ù„Ù†Ø§Ø³', v: 6, p: { s: 604, e: 604 } }
        ];

        // Ø§Ù„Ù‚Ø±Ø§Ø¡
        const RECITERS = [
            { id: 'ar.alafasy', name: 'Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ' },
            { id: 'ar.abdurrahmaanalsudais', name: 'Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³' },
            { id: 'ar.saadalghamdi', name: 'Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ' },
            { id: 'ar.maheralmaeaqly', name: 'Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ' },
            { id: 'ar.abdulbasitmurattal', name: 'Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯' },
            { id: 'ar.husary', name: 'Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ' },
            { id: 'ar.minshawi', name: 'Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ' },
            { id: 'ar.shuraym', name: 'Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…' },
            { id: 'ar.shaatri', name: 'Ø£Ø¨Ùˆ Ø¨ÙƒØ± Ø§Ù„Ø´Ø§Ø·Ø±ÙŠ' },
            { id: 'ar.hanirifai', name: 'Ù‡Ø§Ù†ÙŠ Ø§Ù„Ø±ÙØ§Ø¹ÙŠ' }
        ];

        // 1) Ajoutez cette nouvelle fonction fetchAyahData en haut de votre app.js
        async function fetchAyahData(surah, verse) {
        // RÃ©cupÃ¨re jusqu'au verset demandÃ© avec text_uthmani, page_number et juz_number
        const res = await fetch(
        `https://api.quran.com/api/v4/verses/by_chapter/${surah}` +
        `?language=ar&fields=text_uthmani,page_number,juz_number` +
        `&limit=${verse}&page=1`
        );
        const json = await res.json();
        if (!json.verses || !json.verses[verse - 1]) {
        throw new Error('Verset introuvable');
        }
        const v = json.verses[verse - 1];
        return {
        text: v.text_uthmani,
        page: v.page_number,
        juz: v.juz_number
          };
        }

        // API base
        const API_BASE = 'https://api.alquran.cloud/v1';

        // Utility: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ØºØ±Ø¨ÙŠØ© (Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©) Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
        const toWestern = (n) => String(n).replace(/[\u0660-\u0669]/g, (d) => '0123456789'[d.charCodeAt(0) - 0x660]);

        // Ø§Ù„Ø­Ø§Ù„Ø©
        const state = {
            startSurah: 1,
            startVerse: 1,
            endSurah: 114,
            endVerse: 6,
            attempts: '5',
            reciter: 'ar.alafasy',
            mode: 'verse-number',
            pool: [],
            asked: new Set(),
            correct: 0,
            incorrect: 0,
            startedAt: null,
            endedAt: null,
            activeElapsedMs: 0,
            lastFocusTs: null,
            answeredCurrent: false,
            history: []
        };

        // DOM
        const $ = (sel) => document.querySelector(sel);

        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        function populateSurahs() {
            const startSel = $('#start-surah');
            const endSel = $('#end-surah');
            startSel.innerHTML = '';
            endSel.innerHTML = '';
            SURAHS.forEach(s => {
                const opt1 = document.createElement('option');
                opt1.value = s.n; opt1.textContent = `${s.n} - ${s.name}`;
                startSel.appendChild(opt1);
                const opt2 = document.createElement('option');
                opt2.value = s.n; opt2.textContent = `${s.n} - ${s.name}`;
                endSel.appendChild(opt2);
            });
            startSel.value = '1';
            endSel.value = '114';
            $('#end-verse').value = getSurahByNumber(114).v;
        }

        function populateReciters() {
            const sel = $('#reciter-select');
            sel.innerHTML = '';
            RECITERS.forEach(r => {
                const opt = document.createElement('option');
                opt.value = r.id; opt.textContent = r.name;
                sel.appendChild(opt);
            });
        }

        function getSurahByNumber(n) { return SURAHS.find(s => s.n === Number(n)); }

        // Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
        function validateVerseInputs() {
            const startSurah = Number($('#start-surah').value);
            const endSurah = Number($('#end-surah').value);
            let startVerse = Number($('#start-verse').value) || 1;
            let endVerse = Number($('#end-verse').value) || 1;

            const sS = getSurahByNumber(startSurah);
            const eS = getSurahByNumber(endSurah);

            const startErr = $('#start-verse-error');
            const endErr = $('#end-verse-error');
            startErr.classList.remove('show');
            endErr.classList.remove('show');

            if (startVerse < 1) startVerse = 1;
            if (startVerse > sS.v) {
                startVerse = sS.v;
                startErr.textContent = `Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª Ø³ÙˆØ±Ø© ${sS.name}. ØªÙ… Ø¶Ø¨Ø·Ù‡ Ø¹Ù„Ù‰ ${sS.v}.`;
                startErr.classList.add('show');
            }

            if (endVerse < 1) endVerse = 1;
            if (endVerse > eS.v) {
                endVerse = eS.v;
                endErr.textContent = `Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª Ø³ÙˆØ±Ø© ${eS.name}. ØªÙ… Ø¶Ø¨Ø·Ù‡ Ø¹Ù„Ù‰ ${eS.v}.`;
                endErr.classList.add('show');
            }

            $('#end-verse').setAttribute('max', eS.v);
            $('#start-verse').setAttribute('max', sS.v);

            $('#start-verse').value = startVerse;
            $('#end-verse').value = endVerse;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
            const total = countVersesInRange(startSurah, startVerse, endSurah, endVerse);
            $('#verses-count').textContent = toWestern(total);
        }

        function countVersesInRange(startSurah, startVerse, endSurah, endVerse) {
            if (startSurah > endSurah || (startSurah === endSurah && startVerse > endVerse)) return 0;
            let total = 0;
            for (let s = startSurah; s <= endSurah; s++) {
                const S = getSurahByNumber(s);
                const from = (s === startSurah) ? startVerse : 1;
                const to = (s === endSurah) ? endVerse : S.v;
                total += Math.max(0, to - from + 1);
            }
            return total;
        }

        function buildPool() {
            state.pool = [];
            const sS = Number($('#start-surah').value);
            const eS = Number($('#end-surah').value);
            const sV = Number($('#start-verse').value);
            const eV = Number($('#end-verse').value);
            for (let s = sS; s <= eS; s++) {
                const S = getSurahByNumber(s);
                const from = (s === sS) ? sV : 1;
                const to = (s === eS) ? eV : S.v;
                for (let v = from; v <= to; v++) {
                    state.pool.push({ surah: s, verse: v });
                }
            }
            // Ø®Ù„Ø·
            for (let i = state.pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [state.pool[i], state.pool[j]] = [state.pool[j], state.pool[i]];
            }
            state.asked = new Set();
        }

        // Ø§Ù„Ù…Ø¤Ù‚Øª Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¤ÙŠØ©
        function startTimer() {
            state.startedAt = new Date();
            state.activeElapsedMs = 0;
            state.lastFocusTs = Date.now();
        }

        function setupVisibilityTimer() {
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    state.activeElapsedMs += Date.now() - state.lastFocusTs;
                    } else {
                    state.lastFocusTs = Date.now();
                  // RÃ©acquiert le Wake Lock aprÃ¨s retour au focus
                  preventSleep();
                }
            });
        }

        function formatDuration(ms) {
            const totalSec = Math.floor(ms / 1000);
            const h = String(Math.floor(totalSec / 3600)).padStart(2, '0');
            const m = String(Math.floor((totalSec % 3600) / 60)).padStart(2, '0');
            const s = String(totalSec % 60).padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        function renderRunningTimer() {
            const el = $('#timer-display');
            function tick() {
                let elapsed = state.activeElapsedMs;
                if (!document.hidden) elapsed += Date.now() - state.lastFocusTs;
                el.textContent = formatDuration(elapsed);
                requestAnimationFrame(tick);
            }
            requestAnimationFrame(tick);
        }

        // Ø¹Ø¯Ù… Ø§Ù„Ù†ÙˆÙ… (Ø¬Ø±Ø¨ Wake Lock API)
        async function preventSleep() {
            if ('wakeLock' in navigator) {
                try { await navigator.wakeLock.request('screen'); } catch (e) { /* ØªØ¬Ø§Ù‡Ù„ */ }
            }
        }
        // Garde la rÃ©fÃ©rence au wake lock
        let wakeLock = null;

        async function preventSleep() {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                wakeLock.addEventListener('release', () => {
                    console.log('Wake Lock released');
                });
            } catch (err) {
                console.warn('Wake Lock non disponible :', err);
            }
        }
        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function updateStats() {
            $('#correct-count').textContent = toWestern(state.correct);
            $('#incorrect-count').textContent = toWestern(state.incorrect);
            const total = state.pool.length - state.asked.size;
            $('#remaining-count').textContent = toWestern(total);
        }

        function pickNext() {
            for (let i = 0; i < state.pool.length; i++) {
                const key = `${state.pool[i].surah}:${state.pool[i].verse}`;
                if (!state.asked.has(key)) return state.pool[i];
            }
            return null;
        }

        async function fetchAyahText(surah, verse) {
            const ayahNumber = `${surah}:${verse}`;
            const url = `${API_BASE}/ayah/${ayahNumber}`;
            const res = await fetch(url);
            const json = await res.json();
            if (json.status !== 'OK') throw new Error('Ø®Ø·Ø£ API');
            return json.data.text;
        }

        function buildAudioUrl(reciterId, surah, verse) {
            return `${API_BASE}/ayah/${surah}:${verse}/${reciterId}`;
        }

        async function loadAudio(reciterId, surah, verse) {
            const url = buildAudioUrl(reciterId, surah, verse);
            const res = await fetch(url);
            const json = await res.json();
            if (json.status !== 'OK') throw new Error('Ø®Ø·Ø£ API Ø§Ù„ØµÙˆØª');
            return json.data.audio;
        }

        function currentPageFor(surah) {
            const s = getSurahByNumber(surah);
            return `${s.p.s}`;
        }

        // ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        async function showQuestion(item) {
        updateStats();
        const s = getSurahByNumber(item.surah);
        $('#current-surah-name').textContent = s.name;
        $('#current-verse-number').textContent = toWestern(item.verse);

        // â† ancien fallback statique supprimÃ©
        try {
        const data = await fetchAyahData(item.surah, item.verse);
        $('#current-page-number').textContent = toWestern(data.page);
        } catch (e) {
        console.warn('Page introuvable, fallback start page', e);
        $('#current-page-number').textContent = toWestern(s.p.s);
        }

        $('#verse-text').classList.add('hidden');
        $('#answer-buttons').classList.add('hidden');
        $('#next-question').classList.add('hidden');
        }


        async function revealVerse(item) {
            $('#loading').classList.remove('hidden');
            try {
                const text = await fetchAyahText(item.surah, item.verse);
                $('#verse-text').textContent = text;
                $('#verse-text').classList.remove('hidden');
                $('#answer-buttons').classList.remove('hidden');
            } catch(e) {
                $('#verse-text').textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù†Øµ Ø§Ù„Ø¢ÙŠØ©. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.';
                $('#verse-text').classList.remove('hidden');
            } finally {
                $('#loading').classList.add('hidden');
            }
        }

        async function showAudioQuestion(item) {
            updateStats();
            const audioEl = $('#verse-audio');
            audioEl.src = '';
            $('#verse-info-container').classList.add('hidden');
            $('#audio-answer-buttons').classList.add('hidden');
            $('#next-question').classList.add('hidden');
            $('#audio-verse-text').textContent = '';

            $('#loading').classList.remove('hidden');
            try {
                 const audioUrl = await loadAudio(state.reciter, item.surah, item.verse);
                audioEl.src = audioUrl;
                // Lecture automatique dÃ¨s que lâ€™audio est chargÃ©
                audioEl.play().catch(() => {});
            } catch(e) {

                audioEl.removeAttribute('src');
                $('#audio-verse-text').textContent = 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ø§ÙˆØ©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ùˆ Ø¬Ø±Ù‘Ø¨ Ù‚Ø§Ø±Ø¦Ø§Ù‹ Ø¢Ø®Ø±.';
                $('#verse-info-container').classList.remove('hidden');
            } finally {
                $('#loading').classList.add('hidden');
            }
        }

        // 2) Remplacez votre revealAudioInfo actuelle par celle-ci :
        async function revealAudioInfo(item) {
        // Affiche le nom de la sourate et le numÃ©ro du verset
        const s = getSurahByNumber(item.surah);
        $('#audio-surah-name').textContent = s.name;
        $('#audio-verse-number').textContent = toWestern(item.verse);

        try {
        // Appel unifiÃ© pour texte, page et juz
        const data = await fetchAyahData(item.surah, item.verse);

        // Texte Uthmani
        $('#audio-verse-text').textContent = data.text;

        // NumÃ©ro de page prÃ©cis
        $('#audio-page-number').textContent = toWestern(data.page);

        // NumÃ©ro de Juz (chapitre)
        $('#audio-chapter-number').textContent = toWestern(data.juz);
        } catch (e) {
        console.error('Erreur fetchAyahData:', e);
        // Fallback minimal
        $('#audio-verse-text').textContent = 'ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢ÙŠØ©';
             $('#audio-page-number').textContent = '';
        $('#audio-chapter-number').textContent = '';
        }

       // Affiche le conteneur dâ€™infos et les boutons de rÃ©ponse
       $('#verse-info-container').classList.remove('hidden');
       $('#audio-answer-buttons').classList.remove('hidden');
       }

       function recordAnswer(item, isCorrect, mode) {
       if (!item || state.answeredCurrent) return;  // ignore si dÃ©jÃ  notÃ©e
       state.answeredCurrent = true;                 // marque la question comme notÃ©e

       if (isCorrect) state.correct++;
       else          state.incorrect++;

       // DÃ©sactive les boutons pour empÃªcher un second clic
       document.querySelectorAll('#answer-buttons .answer-btn, #audio-answer-buttons .answer-btn')
       .forEach(btn => btn.disabled = false);

       const s = getSurahByNumber(item.surah);
       state.history.push({
        mode,
        surah: item.surah,
        surahName: s.name,
        verse: item.verse,
        time: new Date().toISOString(),
        correct: !!isCorrect,
       });

       $('#next-question').classList.remove('hidden');
       updateStats();
       }


        function toCSV(rows) {
            const header = ['mode','surah','surahName','verse','time','correct'];
            const lines = [header.join(',')];
            rows.forEach(r => {
                lines.push([r.mode, r.surah, r.surahName, r.verse, r.time, r.correct].join(','));
            });
            return lines.join('\n');
        }

        function endQuiz() {
            state.endedAt = new Date();
            const totalMs = state.activeElapsedMs + (document.hidden ? 0 : (Date.now() - state.lastFocusTs));
            // Ø§Ù„Ù…Ù„Ø®Øµ
            $('#final-correct').textContent = toWestern(state.correct);
            $('#final-incorrect').textContent = toWestern(state.incorrect);
            const total = state.correct + state.incorrect;
            $('#final-total').textContent = toWestern(total);
            const pct = total ? Math.round((state.correct / total) * 100) : 0;
            $('#final-percentage').textContent = `${toWestern(pct)}%`;

            $('#start-time').textContent = new Date(state.startedAt).toLocaleString('fr-FR');
            $('#end-time').textContent = new Date(state.endedAt).toLocaleString('fr-FR');
            $('#total-time').textContent = formatDuration(totalMs);

            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®
            const list = $('#history-list');
            list.innerHTML = '';
            state.history.forEach(h => {
                const div = document.createElement('div');
                div.className = `history-item ${h.correct ? 'correct' : 'incorrect'}`;
                const q = document.createElement('div');
                q.className = 'history-question';
                q.textContent = `Ø³ÙˆØ±Ø© ${h.surahName} - Ø§Ù„Ø¢ÙŠØ© ${toWestern(h.verse)}`;
                const r = document.createElement('div');
                r.className = `history-result ${h.correct ? 'correct' : 'incorrect'}`;
                r.textContent = h.correct ? 'âœ… ØµØ­ÙŠØ­' : 'âŒ Ø®Ø·Ø£';
                div.appendChild(q); div.appendChild(r);
                list.appendChild(div);
            });

            showPage('results-page');
        }

        async function nextQuestionFlow() {
            state.answeredCurrent = false;  // nouvelle question, pas encore notÃ©e
            const attempts = $('#attempts-count').value;
            const totalRequired = attempts === 'infinite' ? Infinity : Number(attempts);
            const answered = state.correct + state.incorrect;
            if (answered >= totalRequired || state.asked.size >= state.pool.length) {
                endQuiz();
                return;
            }

            const item = pickNext();
            if (!item) { endQuiz(); return; }
            state.asked.add(`${item.surah}:${item.verse}`);
            // EmpÃªche la mise en veille Ã  chaque nouvelle question
            preventSleep();

            const mode = state.mode;
            if (mode === 'verse-number') {
            $('#mode-1').classList.add('active');
            $('#mode-2').classList.remove('active');
            await showQuestion(item);  // â† Ajoutez "await" ici
            } else {
            $('#mode-1').classList.remove('active');
            $('#mode-2').classList.add('active');
            showAudioQuestion(item);   // â† Reste inchangÃ©
            }

            // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
            $('#show-verse').onclick = () => revealVerse(item);
            $('#show-verse-info').onclick = () => revealAudioInfo(item);
            $('#play-audio').onclick = () => $('#verse-audio').play();
            $('#repeat-audio').onclick = () => { const a = $('#verse-audio'); a.currentTime = 0; a.play(); };

            document.querySelectorAll('#answer-buttons .answer-btn').forEach(btn => {
                btn.onclick = () => {
                    const isCorrect = btn.dataset.answer === 'correct';
                    recordAnswer(item, isCorrect, 'verse-number');
                };
            });
            document.querySelectorAll('#audio-answer-buttons .answer-btn').forEach(btn => {
                btn.onclick = () => {
                    const isCorrect = btn.dataset.answer === 'correct';
                    recordAnswer(item, isCorrect, 'audio-recitation');
                };
            });

            $('#next-question').onclick = nextQuestionFlow;
        }

        function startQuiz() {
          state.correct = 0;
          state.incorrect = 0;
          state.history = [];

       // RÃ©cupÃ¨re le mode et le rÃ©citateur sÃ©lectionnÃ©s
          state.mode = document.querySelector('input[name="quiz-mode"]:checked').value;
          state.reciter = $('#reciter-select').value;

       // PrÃ©pare le quiz
          buildPool();
          startTimer();
          showPage('quiz-page');
          updateStats();

       // Affiche la premiÃ¨re question
          nextQuestionFlow();

       // Si on est en mode audio, relance la lecture immÃ©diatement
          if (state.mode === 'audio-recitation') {
             const item = pickNext();
             showAudioQuestion(item);
        }

       // EmpÃªche la mise en veille
          preventSleep();
      }

        function bindUI() {
            populateSurahs();
            populateReciters();
            validateVerseInputs();

            $('#start-surah').addEventListener('change', () => validateVerseInputs());
            $('#start-verse').addEventListener('input', () => validateVerseInputs());
            $('#end-surah').addEventListener('change', () => {
                const eS = getSurahByNumber(Number($('#end-surah').value));
                $('#end-verse').value = eS.v;
                validateVerseInputs();
            });
            $('#end-verse').addEventListener('input', () => validateVerseInputs());

            $('#start-quiz').addEventListener('click', startQuiz);
            $('#home-btn').addEventListener('click', () => showPage('home-page'));
            $('#home-btn-results').addEventListener('click', () => showPage('home-page'));
            $('#new-quiz').addEventListener('click', () => showPage('home-page'));

            $('#download-results').addEventListener('click', () => {
                const blob = new Blob([toCSV(state.history)], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'results.csv';
                a.click();
                URL.revokeObjectURL(url);
            });

            renderRunningTimer();
            setupVisibilityTimer();
        }

        window.addEventListener('load', bindUI);

        // ØªØ³Ø¬ÙŠÙ„ Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'quran-quiz-pwa-v1';
                    const OFFLINE_URLS = ['/'];
                    
                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME).then((cache) => cache.addAll(OFFLINE_URLS))
                        );
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('activate', (event) => {
                        event.waitUntil(
                            caches.keys().then((keys) => Promise.all(keys.map((key) => {
                                if (key !== CACHE_NAME) return caches.delete(key);
                            })))
                        );
                        self.clients.claim();
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        const req = event.request;
                        const url = new URL(req.url);
                        
                        if (url.origin === self.location.origin) {
                            event.respondWith(
                                caches.match(req).then((cached) => cached || fetch(req))
                            );
                            return;
                        }
                        
                        if (/alquran\\.cloud|quran\\.com|cdn/.test(url.hostname)) {
                            event.respondWith(
                                fetch(req)
                                    .then((res) => {
                                        const resClone = res.clone();
                                        caches.open(CACHE_NAME).then((cache) => cache.put(req, resClone));
                                        return res;
                                    })
                                    .catch(() => caches.match(req))
                            );
                            return;
                        }
                        
                        event.respondWith(
                            fetch(req).catch(() => caches.match(req))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
